#!/bin/bash
# Calculates the average size on disk of the PGDBs in the given directory, with and without the data directories

if [[ -z $1 ]]; then
	PGDB_DIR=.
else
	PGDB_DIR=$1
fi

PGDB_COUNT=0
PGDB_COUNT_ND=0
PGDB_TOTAL=0
for PGDB in $(ls --color=never $PGDB_DIR); do
	if [[ -e $PGDB/default-version ]]; then
		VER=$(cat $PGDB/default-version)
		if [[ -e $PGDB/$VER ]]; then
			PGDB_SIZE=$(du -sb $PGDB/$VER | cut -d '	' -f 1)
			DATA_SIZE=0
			if [[ -e $PGDB/$VER/data ]]; then
				DATA_SIZE=$(du -sb $PGDB/$VER/data | cut -d '	' -f 1)
			fi
			PGDB_COUNT=$(($PGDB_COUNT+1))
			PGDB_TOTAL=$(($PGDB_TOTAL+$PGDB_SIZE))
			PGDB_TOTAL_ND=$(($PGDB_TOTAL_ND+$PGDB_SIZE-$DATA_SIZE))
		fi
	fi
	echo -n "$PGDB_COUNT"
done
echo "Average (with data): $(($PGDB_TOTAL/$PGDB_COUNT))"
echo "Average (without data): $(($PGDB_TOTAL_ND/$PGDB_COUNT))"

